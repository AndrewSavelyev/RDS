name: Automate Scale AWS RDS Instance

on:
  schedule:
    - cron: "20 17 * * 6"  
    - cron: "40 16 * * 1"  

jobs:
  auto-scale-rds:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        schedule: 
          - name: "rds_scale"
            cron: "20 17 * * 6"
            value: 0
          - name: "rds_scale"
            cron: "40 16 * * 1"
            value: 1

    steps:
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: AKIASBWVINQQWVCC4WEL
          aws-secret-access-key: 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
          aws-region: us-east-1

      - name: Scale down RDS instance
        if: ${{ github.event.schedule == matrix.schedule.cron && matrix.schedule.value == 0 }}
        run: |
          echo "Scaling RDS instance down to db.t3.micro..."
          aws rds modify-db-instance \
            --db-instance-identifier testdb \
            --db-instance-class db.t3.micro \
            --apply-immediately
          echo "✅ Scale down operation triggered successfully."
      
      - name: Scale up RDS instance
        if: ${{ github.event.schedule == matrix.schedule.cron && matrix.schedule.value == 1 }}
        run: |
          echo "Scaling RDS instance up to db.t4g.micro..."
          aws rds modify-db-instance \
            --db-instance-identifier testdb \
            --db-instance-class db.t4g.micro \
            --apply-immediately
          echo "✅ Scale up operation triggered successfully."
